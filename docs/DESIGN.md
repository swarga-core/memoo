# Memoo — Дизайн-документ

> Быстрая записная книжка для macOS с глобальным хоткеем

**Версия документа:** 1.0
**Дата:** 2026-01-21
**Целевая платформа:** macOS 15 Tahoe+

---

## 1. Обзор продукта

### 1.1 Назначение

Memoo — легковесная записная книжка для разработчиков, вызываемая глобальным сочетанием клавиш из любого приложения. Основной сценарий: быстро записать мысль/заметку во время работы, не теряя контекст текущей задачи.

### 1.2 Ключевые принципы

| Принцип | Описание |
|---------|----------|
| **Мгновенность** | Окно появляется за <100ms после нажатия хоткея |
| **Минимализм** | Никаких отвлекающих элементов, только текст и вкладки |
| **Ненавязчивость** | Приложение не мешает основной работе |
| **Надёжность** | Данные никогда не теряются |

### 1.3 Целевая аудитория

- Разработчики ПО
- Пользователи, работающие с несколькими приложениями одновременно
- Люди, практикующие GTD и быстрые заметки

---

## 2. Функциональные требования

### 2.1 Глобальный хоткей

| ID | Требование |
|----|------------|
| GH-01 | Приложение регистрирует глобальный хоткей (по умолчанию `⌥+Space`) |
| GH-02 | Хоткей работает из любого приложения, включая полноэкранные |
| GH-03 | Повторное нажатие хоткея скрывает окно |
| GH-04 | Пользователь может изменить хоткей в настройках |
| GH-05 | При конфликте хоткея — показать уведомление |

### 2.2 Окно приложения

| ID | Требование |
|----|------------|
| WN-01 | Окно типа floating panel — поверх других окон |
| WN-02 | Окно появляется по центру активного экрана |
| WN-03 | Размер окна по умолчанию: 600×400 px |
| WN-04 | Размер окна сохраняется между сессиями |
| WN-05 | Escape скрывает окно |
| WN-06 | Клик вне окна скрывает его (опционально, настраиваемо) |
| WN-07 | Окно не имеет стандартного title bar (compact design) |

### 2.3 Вкладки (Tabs)

| ID | Требование |
|----|------------|
| TB-01 | Вкладки отображаются в верхней части окна |
| TB-02 | Создание новой вкладки: кнопка "+" или `⌘+T` |
| TB-03 | Закрытие вкладки: кнопка "×" на вкладке или `⌘+W` |
| TB-04 | Переключение между вкладками: `⌘+1...9` или клик |
| TB-05 | Перемещение вкладок drag-and-drop |
| TB-06 | Двойной клик на вкладке — переименование |
| TB-07 | Минимум одна вкладка всегда существует |
| TB-08 | При закрытии последней вкладки — создаётся новая пустая |
| TB-09 | Название вкладки по умолчанию: "Untitled" + номер |
| TB-10 | Контекстное меню вкладки: Rename, Duplicate, Close |

### 2.4 Редактор текста (v1.0 — базовый)

| ID | Требование |
|----|------------|
| ED-01 | Простое текстовое поле без форматирования |
| ED-02 | Моноширинный шрифт (SF Mono или Menlo) |
| ED-03 | Автоматическое сохранение при каждом изменении |
| ED-04 | Поддержка стандартных сочетаний: ⌘+Z, ⌘+C, ⌘+V, ⌘+A |
| ED-05 | Курсор устанавливается в конец текста при открытии |
| ED-06 | Поддержка переноса строк (word wrap) |

### 2.5 Хранение данных

| ID | Требование |
|----|------------|
| ST-01 | Данные хранятся локально в `~/Library/Application Support/Memoo/` |
| ST-02 | Формат хранения: SwiftData (SQLite под капотом) |
| ST-03 | Автосохранение с debounce 500ms |
| ST-04 | Сохраняется: текст, название, порядок, дата создания/изменения |
| ST-05 | Сохраняется ID последней активной вкладки |
| ST-06 | Сохраняется позиция и размер окна |

### 2.6 Menu Bar (опционально)

| ID | Требование |
|----|------------|
| MB-01 | Иконка в menu bar для быстрого доступа |
| MB-02 | Клик по иконке показывает/скрывает окно |
| MB-03 | Правый клик — меню с опциями: Settings, Quit |
| MB-04 | Иконку можно скрыть в настройках |

---

## 3. Нефункциональные требования

### 3.1 Производительность

| ID | Требование | Метрика |
|----|------------|---------|
| PF-01 | Время появления окна | < 100ms |
| PF-02 | Время сохранения заметки | < 50ms |
| PF-03 | Потребление RAM в idle | < 50 MB |
| PF-04 | Потребление CPU в idle | < 0.1% |

### 3.2 Надёжность

| ID | Требование |
|----|------------|
| RL-01 | Приложение запускается при старте системы (опционально) |
| RL-02 | Данные не теряются при crash приложения |
| RL-03 | Graceful degradation при ошибках хранилища |

### 3.3 Безопасность

| ID | Требование |
|----|------------|
| SC-01 | Данные хранятся только локально |
| SC-02 | Нет сетевых запросов (кроме проверки обновлений в будущем) |
| SC-03 | Sandbox-совместимость (App Store ready) |

### 3.4 Доступность

| ID | Требование |
|----|------------|
| AC-01 | Поддержка VoiceOver |
| AC-02 | Поддержка увеличенного текста |
| AC-03 | Высокий контраст для всех элементов |

---

## 4. Технический стек

### 4.1 Основные технологии

| Компонент | Технология | Обоснование |
|-----------|------------|-------------|
| UI Framework | SwiftUI | Нативный, современный, декларативный |
| Language | Swift 5.10+ | Стандарт для macOS разработки |
| Storage | SwiftData | Новый Apple ORM, простой API |
| Global Hotkey | HotKey (soffes) | Проверенная библиотека, активно поддерживается |
| Architecture | MVVM | Хорошо сочетается со SwiftUI |
| Min OS | macOS 15.0 | SwiftData improvements, новые API |

### 4.2 Структура проекта

```
Memoo/
├── App/
│   ├── MemooApp.swift           # Entry point, App lifecycle
│   └── AppDelegate.swift        # NSApplicationDelegate для глобальных событий
├── Features/
│   ├── Notes/
│   │   ├── Models/
│   │   │   └── Note.swift       # SwiftData model
│   │   ├── Views/
│   │   │   ├── NoteEditorView.swift
│   │   │   └── TabBarView.swift
│   │   └── ViewModels/
│   │       └── NotesViewModel.swift
│   ├── Settings/
│   │   ├── Views/
│   │   │   └── SettingsView.swift
│   │   └── ViewModels/
│   │       └── SettingsViewModel.swift
│   └── HotKey/
│       └── HotKeyManager.swift
├── Core/
│   ├── Storage/
│   │   └── DataController.swift
│   ├── Window/
│   │   └── FloatingPanel.swift
│   └── Extensions/
│       └── ...
├── Resources/
│   ├── Assets.xcassets
│   └── Localizable.strings
└── Tests/
    ├── MemooTests/
    └── MemooUITests/
```

### 4.3 Зависимости

```swift
// Package.swift dependencies
dependencies: [
    .package(url: "https://github.com/soffes/HotKey", from: "0.2.0")
]
```

---

## 5. Модель данных

### 5.1 Note (SwiftData)

```swift
@Model
final class Note {
    var id: UUID
    var title: String
    var content: String
    var order: Int
    var createdAt: Date
    var updatedAt: Date

    init(
        title: String = "Untitled",
        content: String = "",
        order: Int = 0
    ) {
        self.id = UUID()
        self.title = title
        self.content = content
        self.order = order
        self.createdAt = Date()
        self.updatedAt = Date()
    }
}
```

### 5.2 AppSettings (UserDefaults)

```swift
struct AppSettings {
    @AppStorage("hotkey_keyCode") var hotkeyKeyCode: Int = 49 // Space
    @AppStorage("hotkey_modifiers") var hotkeyModifiers: Int = 2048 // Option
    @AppStorage("lastActiveNoteID") var lastActiveNoteID: String?
    @AppStorage("windowFrame") var windowFrame: String?
    @AppStorage("showMenuBarIcon") var showMenuBarIcon: Bool = true
    @AppStorage("hideOnClickOutside") var hideOnClickOutside: Bool = true
    @AppStorage("launchAtLogin") var launchAtLogin: Bool = false
}
```

---

## 6. UI/UX Спецификация

### 6.1 Цветовая схема

Приложение использует системные цвета macOS для автоматической поддержки светлой и тёмной темы.

| Элемент | Light Mode | Dark Mode |
|---------|------------|-----------|
| Window Background | `.windowBackground` | `.windowBackground` |
| Tab Bar Background | `.controlBackground` | `.controlBackground` |
| Active Tab | `.controlAccent` | `.controlAccent` |
| Text | `.labelColor` | `.labelColor` |
| Editor Background | `.textBackground` | `.textBackground` |

### 6.2 Типографика

| Элемент | Шрифт | Размер |
|---------|-------|--------|
| Tab Title | SF Pro Text | 13pt |
| Editor | SF Mono | 14pt |
| Settings Labels | SF Pro Text | 13pt |

### 6.3 Wireframe

```
┌─────────────────────────────────────────────────────┐
│ ┌───────┬───────┬───────┬───┐                   [×] │  ← Window controls
│ │ Tab 1 │ Tab 2 │ Tab 3 │ + │                       │  ← Tab bar
│ └───────┴───────┴───────┴───┘                       │
├─────────────────────────────────────────────────────┤
│                                                     │
│  Lorem ipsum dolor sit amet, consectetur            │
│  adipiscing elit. Sed do eiusmod tempor             │  ← Text editor
│  incididunt ut labore et dolore magna aliqua.       │
│  |                                                  │  ← Cursor
│                                                     │
│                                                     │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 6.4 Keyboard Shortcuts

| Shortcut | Action |
|----------|--------|
| `⌥+Space` | Show/Hide window (глобальный, настраиваемый) |
| `Escape` | Hide window |
| `⌘+T` | New tab |
| `⌘+W` | Close tab |
| `⌘+1...9` | Switch to tab N |
| `⌘+[` | Previous tab |
| `⌘+]` | Next tab |
| `⌘+,` | Settings |
| `⌘+Q` | Quit application |

---

## 7. Сценарии использования

### 7.1 UC-01: Быстрая запись

**Актор:** Пользователь
**Предусловие:** Приложение запущено в фоне
**Основной поток:**

1. Пользователь работает в IDE
2. Возникает мысль, которую нужно записать
3. Нажимает `⌥+Space`
4. Окно Memoo появляется поверх IDE
5. Последняя активная вкладка уже открыта
6. Курсор в конце текста
7. Пользователь печатает заметку
8. Нажимает `⌥+Space` или `Escape`
9. Окно скрывается, фокус возвращается в IDE
10. Заметка автоматически сохранена

### 7.2 UC-02: Создание новой вкладки

**Актор:** Пользователь
**Предусловие:** Окно Memoo открыто
**Основной поток:**

1. Пользователь нажимает кнопку "+" или `⌘+T`
2. Создаётся новая вкладка "Untitled N"
3. Вкладка становится активной
4. Фокус переходит в текстовый редактор
5. Пользователь может начать вводить текст

### 7.3 UC-03: Переименование вкладки

**Актор:** Пользователь
**Предусловие:** Окно Memoo открыто, есть хотя бы одна вкладка
**Основной поток:**

1. Пользователь делает двойной клик на названии вкладки
2. Название становится редактируемым
3. Пользователь вводит новое название
4. Нажимает Enter или кликает вне поля
5. Название сохраняется

---

## 8. Ограничения и допущения

### 8.1 Ограничения v1.0

- Нет форматирования текста (bold, italic, etc.)
- Нет поддержки изображений
- Нет синхронизации между устройствами
- Нет экспорта/импорта
- Нет поиска по заметкам
- Нет тегов/категорий

### 8.2 Допущения

- Пользователь использует macOS 15+
- Пользователь предоставит разрешение Accessibility для глобального хоткея
- Достаточно места на диске для хранения заметок

---

## 9. Будущие улучшения (v2.0+)

| Приоритет | Функция |
|-----------|---------|
| High | Markdown preview |
| High | Поиск по заметкам |
| Medium | iCloud синхронизация |
| Medium | Экспорт в MD/TXT |
| Medium | Теги и категории |
| Low | Шаблоны заметок |
| Low | Шифрование заметок |

---

## 10. Глоссарий

| Термин | Определение |
|--------|-------------|
| **Floating Panel** | Тип окна macOS, которое остаётся поверх других окон |
| **Global Hotkey** | Сочетание клавиш, работающее в любом приложении |
| **SwiftData** | Фреймворк Apple для ORM и персистентности данных |
| **Menu Bar** | Системная панель macOS в верхней части экрана |
